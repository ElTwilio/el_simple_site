<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ASAP Tickets - Book Cheap Flights</title>
  
  <!-- Segment Analytics.js Snippet -->
  <script>
    !function(){var i="analytics",analytics=window[i]=window[i]||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","screen","once","off","on","addSourceMiddleware","addIntegrationMiddleware","setAnonymousId","addDestinationMiddleware","register"];analytics.factory=function(e){return function(){if(window[i].initialized)return window[i][e].apply(window[i],arguments);var n=Array.prototype.slice.call(arguments);if(["track","screen","alias","group","page","identify"].indexOf(e)>-1){var c=document.querySelector("link[rel='canonical']");n.push({__t:"bpc",c:c&&c.getAttribute("href")||void 0,p:location.pathname,u:location.href,s:location.search,t:document.title,r:document.referrer})}n.unshift(e);analytics.push(n);return analytics}};for(var n=0;n<analytics.methods.length;n++){var key=analytics.methods[n];analytics[key]=analytics.factory(key)}analytics.load=function(key,n){var t=document.createElement("script");t.type="text/javascript";t.async=!0;t.setAttribute("data-global-segment-analytics-key",i);t.src="https://cdn.segment.com/analytics.js/v1/" + key + "/analytics.min.js";var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(t,r);analytics._loadOptions=n};analytics._writeKey="WXLPlJRqYLuTTPDzYjyoMNPLaQKwnWLM";;analytics.SNIPPET_VERSION="5.2.0";
    analytics.load("WXLPlJRqYLuTTPDzYjyoMNPLaQKwnWLM");
    analytics.page();
    }}();
  </script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      color: #333;
      line-height: 1.6;
    }
    
    /* Header */
    .header {
      background-color: #1a4d7a;
      color: white;
      padding: 12px 0;
      text-align: center;
      font-size: 14px;
    }
    
    .header a {
      color: #ffd700;
      text-decoration: none;
      margin-left: 10px;
      font-weight: 600;
    }
    
    /* Navigation */
    .nav {
      background-color: white;
      padding: 15px 40px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .logo {
      font-size: 28px;
      font-weight: bold;
      color: #1a73e8;
      text-transform: lowercase;
    }
    
    .nav-links {
      display: flex;
      gap: 30px;
      align-items: center;
    }
    
    .nav-links a {
      color: #333;
      text-decoration: none;
      font-size: 15px;
      font-weight: 500;
      transition: color 0.3s;
    }
    
    .nav-links a:hover {
      color: #1a73e8;
    }
    
    .auth-buttons {
      display: flex;
      gap: 10px;
    }
    
    .btn {
      padding: 10px 24px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s;
    }
    
    .btn-primary {
      background-color: #1a73e8;
      color: white;
    }
    
    .btn-primary:hover {
      background-color: #1557b0;
    }
    
    .btn-secondary {
      background-color: white;
      color: #1a73e8;
      border: 2px solid #1a73e8;
    }
    
    .btn-secondary:hover {
      background-color: #e8f0fe;
    }
    
    .btn-success {
      background-color: #34a853;
      color: white;
      font-size: 16px;
    }
    
    .btn-success:hover {
      background-color: #2d8e47;
    }
    
    /* Hero Section */
    .hero {
      background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%);
      padding: 60px 40px 80px;
      text-align: center;
      color: white;
    }
    
    .hero h1 {
      font-size: 42px;
      margin-bottom: 15px;
      font-weight: 700;
    }
    
    .hero p {
      font-size: 18px;
      margin-bottom: 40px;
      opacity: 0.95;
    }
    
    /* Search Form */
    .search-container {
      background: white;
      border-radius: 12px;
      padding: 35px;
      max-width: 1100px;
      margin: 0 auto;
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    }
    
    .trip-type {
      display: flex;
      gap: 25px;
      margin-bottom: 25px;
    }
    
    .trip-type label {
      color: #333;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      font-size: 15px;
      font-weight: 500;
    }
    
    .trip-type input[type="radio"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }
    
    .search-form {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 18px;
      margin-bottom: 25px;
    }
    
    .form-group {
      display: flex;
      flex-direction: column;
    }
    
    .form-group label {
      color: #5f6368;
      font-size: 13px;
      margin-bottom: 6px;
      font-weight: 600;
    }
    
    .form-group input,
    .form-group select {
      padding: 14px;
      border: 1px solid #dadce0;
      border-radius: 6px;
      font-size: 15px;
      transition: border-color 0.3s;
    }
    
    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #1a73e8;
    }
    
    .search-btn {
      width: 100%;
      padding: 16px;
      font-size: 17px;
      font-weight: 700;
    }
    
    /* Flight Results */
    .results-section {
      max-width: 1200px;
      margin: 50px auto;
      padding: 0 40px;
      display: none;
    }
    
    .results-section.active {
      display: block;
    }
    
    .results-section h2 {
      font-size: 32px;
      margin-bottom: 25px;
      color: #1a4d7a;
      font-weight: 700;
    }
    
    .flight-card {
      background: white;
      border: 1px solid #e0e0e0;
      border-radius: 12px;
      padding: 30px;
      margin-bottom: 25px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.08);
    }
    
    .flight-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      padding-bottom: 20px;
      border-bottom: 1px solid #e0e0e0;
    }
    
    .airline-info {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .airline-logo {
      width: 60px;
      height: 60px;
      background: #f1f3f4;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 20px;
      color: #1a73e8;
    }
    
    .airline-info h3 {
      font-size: 20px;
      color: #1a4d7a;
      margin-bottom: 4px;
    }
    
    .flight-details {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      gap: 30px;
      align-items: center;
      margin-bottom: 25px;
    }
    
    .flight-time {
      text-align: center;
    }
    
    .time {
      font-size: 28px;
      font-weight: 700;
      color: #1a4d7a;
      margin-bottom: 5px;
    }
    
    .airport {
      color: #5f6368;
      font-size: 15px;
    }
    
    .flight-duration {
      text-align: center;
      color: #5f6368;
      font-size: 14px;
    }
    
    .flight-duration div:first-child {
      font-size: 24px;
      margin-bottom: 5px;
    }
    
    .price-section {
      text-align: right;
    }
    
    .price {
      font-size: 36px;
      font-weight: 700;
      color: #34a853;
      margin-bottom: 5px;
    }
    
    /* Add-ons Section */
    .addons-section {
      background: #f8f9fa;
      padding: 25px;
      border-radius: 8px;
      margin-top: 25px;
    }
    
    .addons-section h3 {
      font-size: 20px;
      margin-bottom: 20px;
      color: #1a4d7a;
      font-weight: 700;
    }
    
    .addon-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 18px;
    }
    
    .addon-card {
      background: white;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .addon-card:hover {
      border-color: #1a73e8;
      box-shadow: 0 4px 12px rgba(26, 115, 232, 0.15);
    }
    
    .addon-card.selected {
      border-color: #34a853;
      background-color: #e6f4ea;
    }
    
    .addon-card h4 {
      font-size: 17px;
      margin-bottom: 10px;
      color: #1a4d7a;
      font-weight: 600;
    }
    
    .addon-card p {
      font-size: 14px;
      color: #5f6368;
      margin-bottom: 12px;
      line-height: 1.5;
    }
    
    .addon-price {
      font-size: 20px;
      font-weight: 700;
      color: #34a853;
    }
    
    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.6);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    
    .modal.active {
      display: flex;
    }
    
    .modal-content {
      background: white;
      border-radius: 12px;
      padding: 40px;
      max-width: 480px;
      width: 90%;
      position: relative;
      max-height: 90vh;
      overflow-y: auto;
    }
    
    .modal-close {
      position: absolute;
      top: 15px;
      right: 20px;
      font-size: 32px;
      cursor: pointer;
      color: #999;
      line-height: 1;
    }
    
    .modal-close:hover {
      color: #333;
    }
    
    .modal-content h2 {
      margin-bottom: 30px;
      color: #1a4d7a;
      font-size: 28px;
      font-weight: 700;
    }
    
    .modal-content .form-group {
      margin-bottom: 20px;
    }
    
    .modal-content input {
      width: 100%;
    }
    
    .modal-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 30px;
      border-bottom: 2px solid #e0e0e0;
    }
    
    .modal-tab {
      padding: 12px 24px;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      margin-bottom: -2px;
      color: #5f6368;
      font-weight: 600;
      font-size: 15px;
    }
    
    .modal-tab.active {
      border-bottom-color: #1a73e8;
      color: #1a73e8;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    /* Added newsletter checkbox styling */
    .newsletter-checkbox {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      margin-bottom: 20px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 6px;
    }
    
    .newsletter-checkbox input[type="checkbox"] {
      width: 20px;
      height: 20px;
      margin-top: 2px;
      cursor: pointer;
    }
    
    .newsletter-checkbox label {
      cursor: pointer;
      font-size: 14px;
      color: #333;
      line-height: 1.5;
    }
    /* </CHANGE> */
    
    /* Stats Section */
    .stats-section {
      background: #f8f9fa;
      padding: 70px 40px;
      text-align: center;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 50px;
      max-width: 1100px;
      margin: 0 auto;
    }
    
    .stat-item h3 {
      font-size: 42px;
      color: #1a73e8;
      margin-bottom: 12px;
      font-weight: 700;
    }
    
    .stat-item p {
      color: #5f6368;
      font-size: 16px;
      font-weight: 500;
    }
    
    /* Features Section */
    .features-section {
      padding: 70px 40px;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .features-section h2 {
      text-align: center;
      font-size: 36px;
      margin-bottom: 50px;
      color: #1a4d7a;
      font-weight: 700;
    }
    
    .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 35px;
    }
    
    .feature-card {
      text-align: center;
      padding: 35px;
      background: #f8f9fa;
      border-radius: 12px;
      transition: transform 0.3s;
    }
    
    .feature-card:hover {
      transform: translateY(-5px);
    }
    
    .feature-icon {
      font-size: 56px;
      margin-bottom: 20px;
    }
    
    .feature-card h3 {
      font-size: 22px;
      margin-bottom: 12px;
      color: #1a4d7a;
      font-weight: 700;
    }
    
    .feature-card p {
      color: #5f6368;
      font-size: 15px;
      line-height: 1.6;
    }
    
    /* User Info Display */
    .user-info {
      display: none;
      align-items: center;
      gap: 12px;
    }
    
    .user-info.active {
      display: flex;
    }
    
    .user-name {
      font-weight: 600;
      color: #1a4d7a;
    }
    
    .logout-btn {
      padding: 8px 16px;
      font-size: 13px;
    }
    
    /* Success Message */
    .success-message {
      display: none;
      background: #34a853;
      color: white;
      padding: 20px;
      text-align: center;
      font-size: 16px;
      font-weight: 600;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 2000;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    
    .success-message.active {
      display: block;
    }
  </style>
</head>
<body>
  <!-- Success Message -->
  <div class="success-message" id="successMessage"></div>
  
  <!-- Header -->
  <div class="header">
    üéüÔ∏è Get your free $30 voucher ‚Äî <a href="#" onclick="showAuthModal('signup'); return false;">Sign Up</a>
  </div>
  
  <!-- Navigation -->
  <nav class="nav">
    <div class="logo">asap tickets</div>
    <div class="nav-links">
      <a href="#">Flights</a>
      <a href="#">Travel Extras</a>
      <a href="#">Help & Support</a>
      <a href="#">About</a>
    </div>
    <div class="auth-buttons">
      <div class="user-info" id="userInfo">
        <span class="user-name" id="userName"></span>
        <button class="btn btn-secondary logout-btn" onclick="logout()">Logout</button>
      </div>
      <div id="authButtons">
        <button class="btn btn-secondary" onclick="showAuthModal('login')">Login</button>
        <button class="btn btn-primary" onclick="showAuthModal('signup')">Sign Up</button>
      </div>
    </div>
  </nav>
  
  <!-- Hero Section -->
  <section class="hero">
    <h1>Book cheap flights and save up to 50% OFF</h1>
    <p>$20+ savings on each ticket | 100% free service | 3+ min tickets sold</p>
    
    <!-- Search Form -->
    <div class="search-container">
      <div class="trip-type">
        <label>
          <input type="radio" name="tripType" value="round-trip" checked> Round-Trip
        </label>
        <label>
          <input type="radio" name="tripType" value="one-way"> One-Way
        </label>
        <label>
          <input type="radio" name="tripType" value="multi-city"> Multi-City Flights
        </label>
      </div>
      
      <form class="search-form" id="searchForm">
        <div class="form-group">
          <label>From</label>
          <input type="text" id="departure" placeholder="Departure City" value="New York (JFK)" required>
        </div>
        
        <div class="form-group">
          <label>To</label>
          <input type="text" id="arrival" placeholder="Arrival City" value="Los Angeles (LAX)" required>
        </div>
        
        <div class="form-group">
          <label>Departure Date</label>
          <input type="date" id="departDate" required>
        </div>
        
        <div class="form-group">
          <label>Return Date</label>
          <input type="date" id="returnDate" required>
        </div>
        
        <div class="form-group">
          <label>Airline Preference</label>
          <select id="airline">
            <option value="">Any Airline</option>
            <option value="American Airlines">American Airlines</option>
            <option value="Delta">Delta</option>
            <option value="United">United</option>
            <option value="Southwest">Southwest</option>
            <option value="JetBlue">JetBlue</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>Passengers</label>
          <select id="passengers">
            <option value="1">1 Passenger</option>
            <option value="2">2 Passengers</option>
            <option value="3">3 Passengers</option>
            <option value="4">4 Passengers</option>
            <option value="5">5+ Passengers</option>
          </select>
        </div>
      </form>
      
      <button class="btn btn-primary search-btn" onclick="searchFlights()">Search Flights</button>
    </div>
  </section>
  
  <!-- Flight Results Section -->
  <section class="results-section" id="resultsSection">
    <h2>Available Flights</h2>
    
    <div class="flight-card">
      <div class="flight-header">
        <div class="airline-info">
          <div class="airline-logo">AA</div>
          <div>
            <h3 id="selectedAirline">American Airlines</h3>
            <p style="color: #5f6368; font-size: 14px;">Flight AA 1234</p>
          </div>
        </div>
        <div class="price-section">
          <div class="price">$375</div>
          <p style="color: #5f6368; font-size: 14px;">per person</p>
        </div>
      </div>
      
      <div class="flight-details">
        <div class="flight-time">
          <div class="time">8:00 AM</div>
          <div class="airport" id="resultDeparture">New York (JFK)</div>
        </div>
        
        <div class="flight-duration">
          <div>‚úàÔ∏è</div>
          <div>5h 30m</div>
          <div>Non-stop</div>
        </div>
        
        <div class="flight-time">
          <div class="time">11:30 AM</div>
          <div class="airport" id="resultArrival">Los Angeles (LAX)</div>
        </div>
      </div>
      
      <!-- Add-ons Section -->
      <div class="addons-section">
        <h3>Enhance Your Trip with Add-ons</h3>
        <div class="addon-options">
          <div class="addon-card" onclick="toggleAddon(this, 'Travel Care Service', 49)">
            <h4>üè• Travel Care Service</h4>
            <p>24/7 medical assistance and travel insurance coverage</p>
            <div class="addon-price">+$49</div>
          </div>
          
          <div class="addon-card" onclick="toggleAddon(this, 'DreamPass', 89)">
            <h4>‚ú® DreamPass</h4>
            <p>Priority boarding, lounge access, and extra baggage</p>
            <div class="addon-price">+$89</div>
          </div>
          
          <div class="addon-card" onclick="toggleAddon(this, 'Baggage Protection', 29)">
            <h4>üß≥ Baggage Protection</h4>
            <p>Full coverage for lost, damaged, or delayed baggage</p>
            <div class="addon-price">+$29</div>
          </div>
        </div>
      </div>
      
      <button class="btn btn-success" style="width: 100%; margin-top: 25px; padding: 18px; font-size: 17px;" onclick="bookFlight()">
        Book This Flight
      </button>
    </div>
  </section>
  
  <!-- Stats Section -->
  <section class="stats-section">
    <div class="stats-grid">
      <div class="stat-item">
        <h3>10+ Million</h3>
        <p>Tickets Sold</p>
      </div>
      <div class="stat-item">
        <h3>97%</h3>
        <p>Recommend ASAP Tickets</p>
      </div>
      <div class="stat-item">
        <h3>20+ Years</h3>
        <p>of Experience</p>
      </div>
      <div class="stat-item">
        <h3>2400+</h3>
        <p>5-Star Reviews</p>
      </div>
    </div>
  </section>
  
  <!-- Features Section -->
  <section class="features-section">
    <h2>Why Choose ASAP Tickets</h2>
    <div class="features-grid">
      <div class="feature-card">
        <div class="feature-icon">üí∞</div>
        <h3>Lowest Fares Guaranteed</h3>
        <p>Discount phone exclusive airfares with partner airlines are unavailable online, with the Best Price Guarantee.</p>
      </div>
      
      <div class="feature-card">
        <div class="feature-icon">üèÜ</div>
        <h3>Award-Winning Live Service</h3>
        <p>Talking to robots can be tough. Travel worry free, knowing that 2,400+ agents are always available to help you.</p>
      </div>
      
      <div class="feature-card">
        <div class="feature-icon">üîí</div>
        <h3>Ultra-Secure & Trusted</h3>
        <p>Your privacy and data security are always our number-one priority - and we are protected by the highest security standards.</p>
      </div>
    </div>
  </section>
  
  <!-- Auth Modal -->
  <div class="modal" id="authModal">
    <div class="modal-content">
      <span class="modal-close" onclick="closeAuthModal()">&times;</span>
      
      <div class="modal-tabs">
        <div class="modal-tab active" id="loginTab" onclick="switchTab('login')">Login</div>
        <div class="modal-tab" id="signupTab" onclick="switchTab('signup')">Sign Up</div>
      </div>
      
      <!-- Login Form -->
      <div class="tab-content active" id="loginContent">
        <h2>Welcome Back</h2>
        <form onsubmit="handleLogin(event)">
          <div class="form-group">
            <label>Email</label>
            <input type="email" id="loginEmail" placeholder="your@email.com" required>
          </div>
          <div class="form-group">
            <label>Password</label>
            <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
          </div>
          <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
        </form>
      </div>
      
      <!-- Signup Form -->
      <div class="tab-content" id="signupContent">
        <h2>Create Account</h2>
        <form onsubmit="handleSignup(event)">
          <div class="form-group">
            <label>First Name</label>
            <input type="text" id="signupFirstName" placeholder="John" required>
          </div>
          <div class="form-group">
            <label>Last Name</label>
            <input type="text" id="signupLastName" placeholder="Doe" required>
          </div>
          <div class="form-group">
            <label>Email</label>
            <input type="email" id="signupEmail" placeholder="your@email.com" required>
          </div>
          <div class="form-group">
            <label>Phone Number</label>
            <input type="tel" id="signupPhone" placeholder="+1 (555) 123-4567" required>
          </div>
          <div class="form-group">
            <label>Password</label>
            <input type="password" id="signupPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
          </div>
          
          <!-- Added newsletter signup checkbox -->
          <div class="newsletter-checkbox">
            <input type="checkbox" id="newsletterOptIn" checked>
            <label for="newsletterOptIn">
              üìß Yes, I want to receive exclusive flight deals, travel tips, and special offers via email newsletter.
            </label>
          </div>
          <!-- </CHANGE> -->
          
          <button type="submit" class="btn btn-primary" style="width: 100%;">Sign Up</button>
        </form>
      </div>
    </div>
  </div>
  
  <script>
    // Global state
    let currentUser = null;
    let selectedAddons = [];
    let currentSearchData = {};
    
    // Set default dates (tomorrow and 7 days from now)
    window.addEventListener('DOMContentLoaded', function() {
      const tomorrow = new Date();
      tomorrow.setDate(tomorrow.getDate() + 1);
      document.getElementById('departDate').valueAsDate = tomorrow;
      
      const returnDate = new Date();
      returnDate.setDate(returnDate.getDate() + 8);
      document.getElementById('returnDate').valueAsDate = returnDate;
      
      // Check for existing user in localStorage
      const savedUser = localStorage.getItem('asapUser');
      if (savedUser) {
        currentUser = JSON.parse(savedUser);
        updateUIForLoggedInUser();
      }
    });
    
    // Auth Modal Functions
    function showAuthModal(tab) {
      document.getElementById('authModal').classList.add('active');
      switchTab(tab);
    }
    
    function closeAuthModal() {
      document.getElementById('authModal').classList.remove('active');
    }
    
    function switchTab(tab) {
      // Update tabs
      document.getElementById('loginTab').classList.toggle('active', tab === 'login');
      document.getElementById('signupTab').classList.toggle('active', tab === 'signup');
      
      // Update content
      document.getElementById('loginContent').classList.toggle('active', tab === 'login');
      document.getElementById('signupContent').classList.toggle('active', tab === 'signup');
    }
    
    // Handle Login
    function handleLogin(event) {
      event.preventDefault();
      
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
      
      // Create user object
      currentUser = {
        email: email,
        userId: 'user_' + Date.now(),
        loginDate: new Date().toISOString()
      };
      
      // Save to localStorage
      localStorage.setItem('asapUser', JSON.stringify(currentUser));
      
      // Segment Identify Call
      analytics.identify(currentUser.userId, {
        email: email,
        login_method: 'email_password'
      });
      
      // Segment Track Call
      analytics.track('User Logged In', {
        email: email,
        login_date: currentUser.loginDate,
        login_method: 'email_password'
      });
      
      updateUIForLoggedInUser();
      closeAuthModal();
      showSuccessMessage('Successfully logged in!');
    }
    
    // Handle Signup
    function handleSignup(event) {
      event.preventDefault();
      
      const firstName = document.getElementById('signupFirstName').value;
      const lastName = document.getElementById('signupLastName').value;
      const email = document.getElementById('signupEmail').value;
      const phone = document.getElementById('signupPhone').value;
      const password = document.getElementById('signupPassword').value;
      const newsletterOptIn = document.getElementById('newsletterOptIn').checked;
      
      // Create user object
      currentUser = {
        userId: 'user_' + Date.now(),
        firstName: firstName,
        lastName: lastName,
        email: email,
        phone: phone,
        signupDate: new Date().toISOString(),
        source: document.referrer || 'direct',
        newsletterSubscribed: newsletterOptIn
      };
      
      // Save to localStorage
      localStorage.setItem('asapUser', JSON.stringify(currentUser));
      
      // Segment Identify Call
      analytics.identify(currentUser.userId, {
        firstName: firstName,
        lastName: lastName,
        email: email,
        phone: phone,
        name: firstName + ' ' + lastName,
        signup_date: currentUser.signupDate,
        source: currentUser.source,
        newsletter_subscribed: newsletterOptIn
      });
      
      // Segment Track Call for Signup
      analytics.track('User Signed Up', {
        firstName: firstName,
        lastName: lastName,
        email: email,
        phone: phone,
        signup_date: currentUser.signupDate,
        signup_method: 'email_password',
        source: currentUser.source,
        newsletter_subscribed: newsletterOptIn
      });
      
      if (newsletterOptIn) {
        analytics.track('Newsletter Subscribed', {
          user_id: currentUser.userId,
          email: email,
          firstName: firstName,
          lastName: lastName,
          subscription_date: currentUser.signupDate,
          subscription_source: 'signup_form'
        });
      }
      // </CHANGE>
      
      updateUIForLoggedInUser();
      closeAuthModal();
      showSuccessMessage('Account created successfully! Welcome to ASAP Tickets!');
    }
    
    // Update UI for logged in user
    function updateUIForLoggedInUser() {
      document.getElementById('authButtons').style.display = 'none';
      document.getElementById('userInfo').classList.add('active');
      
      const displayName = currentUser.firstName 
        ? currentUser.firstName + ' ' + currentUser.lastName 
        : currentUser.email.split('@')[0];
      
      document.getElementById('userName').textContent = displayName;
    }
    
    // Logout
    function logout() {
      // Segment Track Call
      analytics.track('User Logged Out', {
        userId: currentUser.userId,
        email: currentUser.email
      });
      
      // Clear user data
      currentUser = null;
      localStorage.removeItem('asapUser');
      
      // Update UI
      document.getElementById('authButtons').style.display = 'flex';
      document.getElementById('userInfo').classList.remove('active');
      
      // Hide results
      document.getElementById('resultsSection').classList.remove('active');
      
      showSuccessMessage('Logged out successfully');
    }
    
    // Search Flights
    function searchFlights() {
      const departure = document.getElementById('departure').value;
      const arrival = document.getElementById('arrival').value;
      const departDate = document.getElementById('departDate').value;
      const returnDate = document.getElementById('returnDate').value;
      const airline = document.getElementById('airline').value;
      const passengers = document.getElementById('passengers').value;
      const tripType = document.querySelector('input[name="tripType"]:checked').value;
      
      // Store search data
      currentSearchData = {
        departure: departure,
        arrival: arrival,
        departDate: departDate,
        returnDate: returnDate,
        airline: airline || 'Any Airline',
        passengers: parseInt(passengers),
        tripType: tripType,
        searchDate: new Date().toISOString()
      };
      
      // Segment Track Call
      const trackData = {
        departure_city: departure,
        arrival_city: arrival,
        departure_date: departDate,
        return_date: returnDate,
        airline_preference: airline || 'Any Airline',
        passengers: parseInt(passengers),
        trip_type: tripType,
        search_timestamp: currentSearchData.searchDate
      };
      
      // Add user info if logged in
      if (currentUser) {
        trackData.user_id = currentUser.userId;
        trackData.user_email = currentUser.email;
      }
      
      analytics.track('Flight Searched', trackData);
      
      // Update results display
      document.getElementById('resultDeparture').textContent = departure;
      document.getElementById('resultArrival').textContent = arrival;
      
      if (airline) {
        document.getElementById('selectedAirline').textContent = airline;
        document.querySelector('.airline-logo').textContent = airline.substring(0, 2).toUpperCase();
      } else {
        document.getElementById('selectedAirline').textContent = 'American Airlines';
        document.querySelector('.airline-logo').textContent = 'AA';
      }
      
      // Show results
      document.getElementById('resultsSection').classList.add('active');
      document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
      
      // Reset addons
      selectedAddons = [];
      document.querySelectorAll('.addon-card').forEach(card => {
        card.classList.remove('selected');
      });
    }
    
    // Toggle Add-on
    function toggleAddon(element, addonName, price) {
      const isSelected = element.classList.contains('selected');
      element.classList.toggle('selected');
      
      if (isSelected) {
        // Remove addon
        selectedAddons = selectedAddons.filter(a => a.name !== addonName);
      } else {
        // Add addon
        selectedAddons.push({ name: addonName, price: price });
        
        // Segment Track Call for Add-on Selection
        const trackData = {
          addon_name: addonName,
          addon_price: price,
          flight_departure: currentSearchData.departure,
          flight_arrival: currentSearchData.arrival,
          airline: currentSearchData.airline,
          selection_timestamp: new Date().toISOString()
        };
        
        if (currentUser) {
          trackData.user_id = currentUser.userId;
          trackData.user_email = currentUser.email;
        }
        
        analytics.track('Add-on Selected', trackData);
      }
    }
    
    // Book Flight
    function bookFlight() {
      if (!currentUser) {
        showSuccessMessage('Please login or sign up to book a flight');
        setTimeout(() => showAuthModal('signup'), 1500);
        return;
      }
      
      const basePrice = 375;
      const addonsTotal = selectedAddons.reduce((sum, addon) => sum + addon.price, 0);
      const totalPrice = (basePrice + addonsTotal) * currentSearchData.passengers;
      
      // Segment Track Call for Booking
      const trackData = {
        user_id: currentUser.userId,
        user_email: currentUser.email,
        booking_id: 'booking_' + Date.now(),
        departure_city: currentSearchData.departure,
        arrival_city: currentSearchData.arrival,
        departure_date: currentSearchData.departDate,
        return_date: currentSearchData.returnDate,
        airline: currentSearchData.airline,
        passengers: currentSearchData.passengers,
        trip_type: currentSearchData.tripType,
        base_price: basePrice,
        addons: selectedAddons.map(a => a.name),
        addons_total: addonsTotal,
        total_price: totalPrice,
        currency: 'USD',
        booking_timestamp: new Date().toISOString(),
        has_travel_care: selectedAddons.some(a => a.name === 'Travel Care Service'),
        has_dreampass: selectedAddons.some(a => a.name === 'DreamPass'),
        has_baggage_protection: selectedAddons.some(a => a.name === 'Baggage Protection')
      };
      
      analytics.track('Booking Completed', trackData);
      
      // Update user's last purchase date in localStorage
      currentUser.lastPurchaseDate = new Date().toISOString();
      currentUser.totalPurchases = (currentUser.totalPurchases || 0) + 1;
      localStorage.setItem('asapUser', JSON.stringify(currentUser));
      
      // Update identify with purchase info
      analytics.identify(currentUser.userId, {
        last_purchase_date: currentUser.lastPurchaseDate,
        total_purchases: currentUser.totalPurchases,
        last_airline: currentSearchData.airline,
        has_purchased_addons: selectedAddons.length > 0
      });
      
      showSuccessMessage(`Booking confirmed! Total: $${totalPrice}. Confirmation sent to ${currentUser.email}`);
      
      // Scroll to top
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    
    // Show Success Message
    function showSuccessMessage(message) {
      const messageEl = document.getElementById('successMessage');
      messageEl.textContent = message;
      messageEl.classList.add('active');
      
      setTimeout(() => {
        messageEl.classList.remove('active');
      }, 4000);
    }
  </script>
</body>
</html>
