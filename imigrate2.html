<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iMigrate - Make Your Dreams Real</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Segment Analytics Script -->
    <script>
      !function(){var i="analytics",analytics=window[i]=window[i]||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","screen","once","off","on","addSourceMiddleware","addIntegrationMiddleware","setAnonymousId","addDestinationMiddleware","register"];analytics.factory=function(e){return function(){if(window[i].initialized)return window[i][e].apply(window[i],arguments);var n=Array.prototype.slice.call(arguments);if(["track","screen","alias","group","page","identify"].indexOf(e)>-1){var c=document.querySelector("link[rel='canonical']");n.push({__t:"bpc",c:c&&c.getAttribute("href")||void 0,p:location.pathname,u:location.href,s:location.search,t:document.title,r:document.referrer})}n.unshift(e);analytics.push(n);return analytics}};for(var n=0;n<analytics.methods.length;n++){var key=analytics.methods[n];analytics[key]=analytics.factory(key)}analytics.load=function(key,n){var t=document.createElement("script");t.type="text/javascript";t.async=!0;t.setAttribute("data-global-segment-analytics-key",i);t.src="https://cdn.segment.com/analytics.js/v1/" + key + "/analytics.min.js";var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(t,r);analytics._loadOptions=n};analytics._writeKey="rjeEmySbA3mHw00R8WOV8tmv8Mxdw0xi";;analytics.SNIPPET_VERSION="5.2.0";
      analytics.load("rjeEmySbA3mHw00R8WOV8tmv8Mxdw0xi");
      analytics.page();
      }}();
    </script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2d5a5a 0%, #4a8080 50%, #2d5a5a 100%);
            min-height: 100vh;
            color: white;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 40px;
            position: relative;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
        }

        .logo i {
            margin-right: 8px;
            color: #ffd700;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .language-selector {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.1);
            transition: background 0.3s ease;
        }

        .language-selector:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s ease;
            text-align: center;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid white;
            color: white;
        }

        .btn-outline:hover {
            background: white;
            color: #2d5a5a;
        }

        .btn-primary {
            background: #ffd700;
            color: #2d5a5a;
            border: 2px solid #ffd700;
        }

        .btn-primary:hover {
            background: #ffed4e;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        }

        .hero {
            text-align: center;
            padding: 80px 40px 60px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .hero h1 {
            font-size: 3.5rem;
            font-weight: 300;
            line-height: 1.2;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .hero p {
            font-size: 1.2rem;
            margin-bottom: 40px;
            opacity: 0.9;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.6;
        }

        .cta-button {
            font-size: 1.1rem;
            padding: 16px 40px;
            margin-bottom: 80px;
        }

        .family-photos {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 40px;
            flex-wrap: wrap;
        }

        .photo {
            width: 160px;
            height: 120px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }

        .photo:hover {
            transform: translateY(-5px);
        }

        .photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .content-section {
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            padding: 80px 40px;
            margin-top: 100px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 40px;
            margin-bottom: 60px;
        }

        .feature {
            text-align: center;
            padding: 30px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .feature:hover {
            transform: translateY(-5px);
        }

        .feature i {
            font-size: 3rem;
            color: #4a8080;
            margin-bottom: 20px;
        }

        .feature h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: #2d5a5a;
        }

        .feature p {
            line-height: 1.6;
            color: #666;
        }

        .process-steps {
            margin-top: 60px;
        }

        .process-steps h2 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 50px;
            color: #2d5a5a;
        }

        .steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
        }

        .step {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .step-number {
            position: absolute;
            top: -15px;
            left: 30px;
            background: #ffd700;
            color: #2d5a5a;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .step h4 {
            margin-top: 15px;
            margin-bottom: 15px;
            color: #2d5a5a;
            font-size: 1.3rem;
        }

        .step p {
            color: #666;
            line-height: 1.6;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 40px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            position: relative;
            color: #333;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            right: 20px;
            top: 15px;
        }

        .close:hover {
            color: #000;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d5a5a;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #4a8080;
        }

        .upload-area {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 20px 0;
        }

        .upload-area:hover {
            border-color: #4a8080;
            background: #f8f9fa;
        }

        .upload-area.dragover {
            border-color: #4a8080;
            background: #e8f4f8;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
            display: none;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4a8080, #2d5a5a);
            width: 0%;
            transition: width 0.3s ease;
        }

        @media (max-width: 768px) {
            .header {
                padding: 15px 20px;
                flex-direction: column;
                gap: 15px;
            }

            .hero h1 {
                font-size: 2.5rem;
            }

            .hero {
                padding: 40px 20px;
            }

            .family-photos {
                padding: 0 20px;
            }

            .photo {
                width: 140px;
                height: 100px;
            }

            .content-section {
                padding: 40px 20px;
            }
        }

        /* Added styles for new resources section and modal */
        .resources-section {
            background: rgba(255, 255, 255, 0.98);
            color: #333;
            padding: 80px 40px;
            margin-top: 0;
        }

        .resources-section h2 {
            text-align: center;
            color: #2d5a5a;
            font-size: 2.5rem;
            margin-bottom: 20px;
        }

        .section-subtitle {
            text-align: center;
            color: #666;
            font-size: 1.2rem;
            margin-bottom: 50px;
        }

        .resource-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .resource-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .resource-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            border-color: #4a8080;
        }

        .resource-card i {
            font-size: 3rem;
            color: #4a8080;
            margin-bottom: 20px;
        }

        .resource-card h3 {
            color: #2d5a5a;
            font-size: 1.5rem;
            margin-bottom: 15px;
        }

        .resource-card p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .read-more {
            color: #4a8080;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .read-more i {
            font-size: 0.8rem;
            margin-left: 5px;
            transition: transform 0.3s ease;
        }

        .resource-card:hover .read-more i {
            transform: translateX(5px);
        }

        .resource-modal-content {
            max-width: 700px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .resource-modal-content h2 {
            color: #2d5a5a;
            margin-bottom: 20px;
            border-bottom: 2px solid #4a8080;
            padding-bottom: 10px;
        }

        .resource-modal-content h3 {
            color: #4a8080;
            margin-top: 25px;
            margin-bottom: 15px;
        }

        .resource-modal-content ul {
            margin-left: 20px;
            margin-bottom: 20px;
        }

        .resource-modal-content li {
            margin-bottom: 8px;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <i class="fas fa-globe-americas"></i>
            iMigrate
        </div>
        <!-- Fixed language selector image URL -->
        <div class="header-right">
            <div class="language-selector" onclick="trackLanguageChange()">
                <img src="/placeholder.svg?height=15&width=20&text=EN" alt="English" style="width: 20px; height: 15px;">
                <span>EN</span>
                <i class="fas fa-chevron-down" style="font-size: 12px;"></i>
            </div>
            <a href="#" class="btn btn-outline" onclick="showLoginModal()">Log In</a>
            <a href="#" class="btn btn-primary" onclick="startProcess()">Start My Process</a>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <h1>At iMigrate, we're here to help make<br>your dreams real.</h1>
        <p>Go ahead with your paperwork—no fear needed. At iMigrate, we explain everything clearly and guide you step by step—for a fair price.</p>
        <a href="#" class="btn btn-primary cta-button" onclick="startProcess()">Start My Process</a>
        
        <!-- Family Photos -->
        <div class="family-photos">
            <div class="photo">
                <!-- Fixed image URLs to use proper placeholder format -->
                <img src="https://framerusercontent.com/images/ZRUTvqLLSwHzNJkBnDzD3qvlcM8.jpg?scale-down-to=512" alt="Happy Family">
            </div>
            <div class="photo">
                <img src="https://framerusercontent.com/images/r1fNfBPn3or6YxlXC8NPt1GbYY.jpg?scale-down-to=512" alt="Mother and Daughter">
            </div>
            <div class="photo">
                <img src="https://framerusercontent.com/images/1G9Pd3OMsBKa3rRVtjIOjClKVu8.jpg?scale-down-to=1024" alt="Young Couple">
            </div>
            <div class="photo">
                <img src="https://framerusercontent.com/images/XDT3FjkpfOi1diGyiWQFaNhPGTU.jpg?scale-down-to=512" alt="Large Family">
            </div>
            <div class="photo">
                <img src="https://framerusercontent.com/images/djIDGWU4VcLY2wrOnoRSsv94.jpg?scale-down-to=2048" alt="Elderly Couple">
            </div>
        </div>
    </section>

    <!-- Added new Immigration Resources section with interactive cards -->
    <!-- Immigration Resources Section -->
    <section class="resources-section">
        <div class="container">
            <h2>Immigration Resources & Information</h2>
            <p class="section-subtitle">Click on any topic to learn more about your immigration journey</p>
            
            <div class="resource-grid">
                <div class="resource-card" onclick="showResourceModal('visa-types')">
                    <i class="fas fa-passport"></i>
                    <h3>Visa Types</h3>
                    <p>Learn about different visa categories and which one is right for you</p>
                    <span class="read-more">Click to read more <i class="fas fa-arrow-right"></i></span>
                </div>
                
                <div class="resource-card" onclick="showResourceModal('green-card')">
                    <i class="fas fa-id-card"></i>
                    <h3>Green Card Process</h3>
                    <p>Understanding the path to permanent residency in the United States</p>
                    <span class="read-more">Click to read more <i class="fas fa-arrow-right"></i></span>
                </div>
                
                <div class="resource-card" onclick="showResourceModal('citizenship')">
                    <i class="fas fa-flag-usa"></i>
                    <h3>Path to Citizenship</h3>
                    <p>Requirements and steps for becoming a U.S. citizen</p>
                    <span class="read-more">Click to read more <i class="fas fa-arrow-right"></i></span>
                </div>
                
                <div class="resource-card" onclick="showResourceModal('family-immigration')">
                    <i class="fas fa-heart"></i>
                    <h3>Family Immigration</h3>
                    <p>Bringing family members to the United States legally</p>
                    <span class="read-more">Click to read more <i class="fas fa-arrow-right"></i></span>
                </div>
                
                <div class="resource-card" onclick="showResourceModal('work-permits')">
                    <i class="fas fa-briefcase"></i>
                    <h3>Work Authorization</h3>
                    <p>Employment-based immigration and work permits</p>
                    <span class="read-more">Click to read more <i class="fas fa-arrow-right"></i></span>
                </div>
                
                <div class="resource-card" onclick="showResourceModal('asylum-refugee')">
                    <i class="fas fa-shield-alt"></i>
                    <h3>Asylum & Refugee Status</h3>
                    <p>Protection for those fleeing persecution or violence</p>
                    <span class="read-more">Click to read more <i class="fas fa-arrow-right"></i></span>
                </div>
            </div>
        </div>
    </section>

    <!-- Content Section -->
    <section class="content-section">
        <div class="container">
            <div class="features">
                <div class="feature">
                    <i class="fas fa-shield-alt"></i>
                    <h3>Secure & Confidential</h3>
                    <p>Your personal information is protected with bank-level security. We never share your data without your explicit consent.</p>
                </div>
                <div class="feature">
                    <i class="fas fa-users"></i>
                    <h3>Expert Legal Support</h3>
                    <p>Our team of experienced immigration attorneys and legal experts guide you through every step of your journey.</p>
                </div>
                <div class="feature">
                    <i class="fas fa-clock"></i>
                    <h3>Fast Processing</h3>
                    <p>We streamline the immigration process to help you achieve your goals as quickly and efficiently as possible.</p>
                </div>
            </div>

            <div class="process-steps">
                <h2>How It Works</h2>
                <div class="steps">
                    <div class="step">
                        <div class="step-number">1</div>
                        <h4>Create Your Account</h4>
                        <p>Sign up and tell us about your immigration goals. We'll create a personalized plan just for you.</p>
                    </div>
                    <div class="step">
                        <div class="step-number">2</div>
                        <h4>Complete Your Application</h4>
                        <p>Fill out your forms with our guided assistance. We'll help you avoid common mistakes and delays.</p>
                    </div>
                    <div class="step">
                        <div class="step-number">3</div>
                        <h4>Upload Documents</h4>
                        <p>Securely upload all required documents. Our system will verify everything is complete and correct.</p>
                    </div>
                    <div class="step">
                        <div class="step-number">4</div>
                        <h4>Submit & Track</h4>
                        <p>We'll submit your application and keep you updated on its progress every step of the way.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('loginModal')">&times;</span>
            <h2 style="color: #2d5a5a; margin-bottom: 30px;">Welcome Back</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="email">Email Address</label>
                    <input type="email" id="email" name="email" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;">Log In</button>
            </form>
            <p style="text-align: center; margin-top: 20px;">
                Don't have an account? <a href="#" onclick="closeModal('loginModal'); showSignupModal();" style="color: #4a8080;">Sign up here</a>
            </p>
        </div>
    </div>

    <!-- Signup Modal -->
    <div id="signupModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('signupModal')">&times;</span>
            <h2 style="color: #2d5a5a; margin-bottom: 30px;">Create Your Account</h2>
            <form id="signupForm">
                <div class="form-group">
                    <label for="firstName">First Name</label>
                    <input type="text" id="firstName" name="firstName" required>
                </div>
                <div class="form-group">
                    <label for="lastName">Last Name</label>
                    <input type="text" id="lastName" name="lastName" required>
                </div>
                <div class="form-group">
                    <label for="signupEmail">Email Address</label>
                    <input type="email" id="signupEmail" name="email" required>
                </div>
                <div class="form-group">
                    <label for="phone">Phone Number</label>
                    <input type="tel" id="phone" name="phone" required>
                </div>
                <div class="form-group">
                    <label for="country">Country of Origin</label>
                    <select id="country" name="country" required>
                        <option value="">Select your country</option>
                        <option value="mexico">Mexico</option>
                        <option value="colombia">Colombia</option>
                        <option value="venezuela">Venezuela</option>
                        <option value="guatemala">Guatemala</option>
                        <option value="honduras">Honduras</option>
                        <option value="el-salvador">El Salvador</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="signupPassword">Password</label>
                    <input type="password" id="signupPassword" name="password" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;">Create Account</button>
            </form>
        </div>
    </div>

    <!-- Application Modal -->
    <div id="applicationModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <span class="close" onclick="closeModal('applicationModal')">&times;</span>
            <h2 style="color: #2d5a5a; margin-bottom: 30px;">Immigration Application</h2>
            
            <div id="applicationStep1" class="application-step">
                <h3 style="color: #4a8080; margin-bottom: 20px;">Step 1: Personal Information</h3>
                <form id="personalInfoForm">
                    <div class="form-group">
                        <label for="fullName">Full Legal Name</label>
                        <input type="text" id="fullName" name="fullName" required>
                    </div>
                    <div class="form-group">
                        <label for="dateOfBirth">Date of Birth</label>
                        <input type="date" id="dateOfBirth" name="dateOfBirth" required>
                    </div>
                    <div class="form-group">
                        <label for="nationality">Nationality</label>
                        <input type="text" id="nationality" name="nationality" required>
                    </div>
                    <div class="form-group">
                        <label for="currentAddress">Current Address</label>
                        <input type="text" id="currentAddress" name="currentAddress" required>
                    </div>
                    <button type="button" class="btn btn-primary" onclick="nextApplicationStep(2)">Continue</button>
                </form>
            </div>

            <div id="applicationStep2" class="application-step" style="display: none;">
                <h3 style="color: #4a8080; margin-bottom: 20px;">Step 2: Document Upload</h3>
                <p style="margin-bottom: 20px;">Please upload the required documents:</p>
                
                <div class="upload-area" onclick="document.getElementById('passportUpload').click()">
                    <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; color: #4a8080; margin-bottom: 10px;"></i>
                    <p><strong>Upload Passport</strong></p>
                    <p style="font-size: 14px; color: #666;">Click here or drag and drop your passport scan</p>
                    <input type="file" id="passportUpload" style="display: none;" accept=".pdf,.jpg,.jpeg,.png" onchange="handleFileUpload(this, 'passport')">
                </div>

                <div class="upload-area" onclick="document.getElementById('idUpload').click()">
                    <i class="fas fa-id-card" style="font-size: 2rem; color: #4a8080; margin-bottom: 10px;"></i>
                    <p><strong>Upload Government ID</strong></p>
                    <p style="font-size: 14px; color: #666;">Click here or drag and drop your ID scan</p>
                    <input type="file" id="idUpload" style="display: none;" accept=".pdf,.jpg,.jpeg,.png" onchange="handleFileUpload(this, 'id')">
                </div>

                <div class="progress-bar" id="uploadProgress">
                    <div class="progress-fill" id="progressFill"></div>
                </div>

                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="button" class="btn btn-outline" onclick="nextApplicationStep(1)">Back</button>
                    <button type="button" class="btn btn-primary" onclick="nextApplicationStep(3)" id="continueStep2" disabled>Continue</button>
                </div>
            </div>

            <div id="applicationStep3" class="application-step" style="display: none;">
                <h3 style="color: #4a8080; margin-bottom: 20px;">Step 3: Review & Submit</h3>
                <p style="margin-bottom: 20px;">Please review your information before submitting:</p>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <h4 style="color: #2d5a5a; margin-bottom: 15px;">Application Summary</h4>
                    <div id="applicationSummary"></div>
                </div>

                <div style="display: flex; gap: 10px;">
                    <button type="button" class="btn btn-outline" onclick="nextApplicationStep(2)">Back</button>
                    <button type="button" class="btn btn-primary" onclick="submitApplication()">Submit Application</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Added Resource Modal for displaying immigration information -->
    <!-- Resource Modal -->
    <div id="resourceModal" class="modal">
        <div class="modal-content resource-modal-content">
            <span class="close" onclick="closeResourceModal()">&times;</span>
            <div id="resourceContent">
                <!-- Content will be dynamically loaded here -->
            </div>
        </div>
    </div>

    <script>
        // Declare the analytics variable or import it as needed
        const analytics = window.analytics || {}

        // Segment Analytics Helper Functions
        function trackEvent(eventName, properties = {}) {
          if (typeof analytics !== "undefined") {
            analytics.track(eventName, {
              ...properties,
              timestamp: new Date().toISOString(),
              page: window.location.pathname,
              url: window.location.href,
            })
            console.log(`[Segment] Tracked event: ${eventName}`, properties)
          }
        }

        function identifyUser(userId, traits = {}) {
          if (typeof analytics !== "undefined") {
            analytics.identify(userId, traits)
            console.log(`[Segment] Identified user: ${userId}`, traits)
          }
        }

        function trackPage(pageName, properties = {}) {
          if (typeof analytics !== "undefined") {
            analytics.page(pageName, properties)
            console.log(`[Segment] Page view: ${pageName}`, properties)
          }
        }

        // Global variables
        let currentUser = null
        let applicationData = { personalInfo: {}, documents: {} }
        let uploadedFiles = {}
        let currentStage = 'lead'
        let npsShown = {}

        function showNPSModal(stage) {
          if (npsShown[stage]) return;
          
          const npsModal = document.createElement('div');
          npsModal.className = 'modal';
          npsModal.style.display = 'block';
          npsModal.innerHTML = `
            <div class="modal-content" style="max-width: 400px;">
              <span class="close" onclick="closeNPSModal('${stage}')">&times;</span>
              <h3>How likely are you to recommend iMigrate?</h3>
              <div style="display: flex; justify-content: space-between; margin: 20px 0;">
                ${Array.from({length: 11}, (_, i) => 
                  `<button onclick="submitNPS(${i}, '${stage}')" style="width: 30px; height: 30px; margin: 2px;">${i}</button>`
                ).join('')}
              </div>
              <div style="display: flex; justify-content: space-between; font-size: 12px;">
                <span>Not likely</span>
                <span>Very likely</span>
              </div>
            </div>
          `;
          document.body.appendChild(npsModal);
          
          trackEvent("NPS Check", {
            user_id: currentUser?.id,
            stage: stage,
            modal_shown: true
          });
        }

        function closeNPSModal(stage) {
          const modal = document.querySelector('.modal');
          if (modal) modal.remove();
          npsShown[stage] = true;
        }

        function submitNPS(score, stage) {
          trackEvent("NPS Check", {
            user_id: currentUser?.id,
            stage: stage,
            nps_score: score,
            response_type: score >= 9 ? 'promoter' : score >= 7 ? 'passive' : 'detractor'
          });
          closeNPSModal(stage);
        }

        // Page load tracking
        document.addEventListener("DOMContentLoaded", () => {
          trackPage("Homepage", {
            section: "landing",
            user_type: "anonymous",
          })

          trackEvent("Lead Created", {
            source: "website_visit",
            page: "homepage",
            referrer: document.referrer || "direct"
          });

          // Track time spent on page
          const startTime = Date.now()
          window.addEventListener("beforeunload", () => {
            const timeSpent = Math.round((Date.now() - startTime) / 1000)
            trackEvent("Page Time Spent", {
              page: "homepage",
              time_seconds: timeSpent,
            })
          })
        })

        function startProcess() {
          trackEvent("Lead Qualified", {
            button_location: "hero_section",
            qualification_method: "start_process_click",
            user_authenticated: currentUser !== null,
          })

          showSignupModal()
        }

        function selectProduct(productType) {
          trackEvent("Product Selected", {
            user_id: currentUser?.id,
            product_type: productType,
            product_name: `Immigration ${productType} Service`,
            price: productType === 'premium' ? 599 : 299
          });
          
          currentStage = 'product_selected';
          showCheckoutModal(productType);
        }

        function showCheckoutModal(productType) {
          const checkoutModal = document.createElement('div');
          checkoutModal.className = 'modal';
          checkoutModal.id = 'checkoutModal';
          checkoutModal.style.display = 'block';
          checkoutModal.innerHTML = `
            <div class="modal-content">
              <span class="close" onclick="closeModal('checkoutModal')">&times;</span>
              <h2>Complete Your Purchase</h2>
              <div style="padding: 20px;">
                <h3>${productType === 'premium' ? 'Premium' : 'Standard'} Immigration Service</h3>
                <p>Price: $${productType === 'premium' ? '599' : '299'}</p>
                <form id="checkoutForm">
                  <input type="text" placeholder="Card Number" required style="width: 100%; margin: 10px 0; padding: 10px;">
                  <input type="text" placeholder="Expiry Date" required style="width: 48%; margin: 10px 1%; padding: 10px;">
                  <input type="text" placeholder="CVV" required style="width: 48%; margin: 10px 1%; padding: 10px;">
                  <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;">Complete Payment</button>
                </form>
              </div>
            </div>
          `;
          document.body.appendChild(checkoutModal);

          trackEvent("Checkout Initiated", {
            user_id: currentUser?.id,
            product_type: productType,
            checkout_value: productType === 'premium' ? 599 : 299,
            currency: 'USD'
          });

          // Handle checkout form
          document.getElementById('checkoutForm').addEventListener('submit', (e) => {
            e.preventDefault();
            processPayment(productType);
          });
        }

        function processPayment(productType) {
          trackEvent("Payment Processed", {
            user_id: currentUser?.id,
            product_type: productType,
            payment_amount: productType === 'premium' ? 599 : 299,
            payment_method: 'credit_card',
            transaction_id: 'txn_' + Date.now()
          });

          closeModal('checkoutModal');
          currentStage = 'payment_processed';
          showContractModal();
        }

        function showContractModal() {
          const contractModal = document.createElement('div');
          contractModal.className = 'modal';
          contractModal.id = 'contractModal';
          contractModal.style.display = 'block';
          contractModal.innerHTML = `
            <div class="modal-content">
              <span class="close" onclick="closeModal('contractModal')">&times;</span>
              <h2>Service Agreement</h2>
              <div style="padding: 20px; max-height: 300px; overflow-y: scroll; border: 1px solid #ccc; margin: 20px 0;">
                <p>This agreement outlines the terms of service for your immigration assistance...</p>
                <p>By signing below, you agree to the terms and conditions...</p>
              </div>
              <button onclick="signContract()" class="btn btn-primary">Sign Contract</button>
            </div>
          `;
          document.body.appendChild(contractModal);
        }

        function signContract() {
          trackEvent("Contract Signed", {
            user_id: currentUser?.id,
            contract_type: 'immigration_service',
            signature_method: 'digital',
            signed_at: new Date().toISOString()
          });

          closeModal('contractModal');
          currentStage = 'contract_signed';
          startOnboarding();
        }

        function startOnboarding() {
          setTimeout(() => {
            showOnboardingModal();
          }, 1000);
        }

        function showOnboardingModal() {
          const onboardingModal = document.createElement('div');
          onboardingModal.className = 'modal';
          onboardingModal.id = 'onboardingModal';
          onboardingModal.style.display = 'block';
          onboardingModal.innerHTML = `
            <div class="modal-content">
              <span class="close" onclick="closeModal('onboardingModal')">&times;</span>
              <h2>Welcome to iMigrate!</h2>
              <div style="padding: 20px;">
                <h3>Complete Your Onboarding</h3>
                <div id="onboardingSteps">
                  <div class="onboarding-step" data-step="1">
                    <h4>Step 1: Complete Questionnaire</h4>
                    <button onclick="completeQuestionnaire()" class="btn btn-secondary">Start Questionnaire</button>
                  </div>
                  <div class="onboarding-step" data-step="2" style="display: none;">
                    <h4>Step 2: Upload Documents</h4>
                    <button onclick="showDocumentUpload()" class="btn btn-secondary">Upload Documents</button>
                  </div>
                  <div class="onboarding-step" data-step="3" style="display: none;">
                    <h4>Step 3: Download Client Packet</h4>
                    <button onclick="downloadClientPacket()" class="btn btn-secondary">Download Packet</button>
                  </div>
                </div>
              </div>
            </div>
          `;
          document.body.appendChild(onboardingModal);
        }

        function completeQuestionnaire() {
          trackEvent("Questionnaire Answered", {
            user_id: currentUser?.id,
            questionnaire_type: 'immigration_intake',
            completion_time: new Date().toISOString(),
            questions_answered: 15
          });

          document.querySelector('[data-step="1"]').style.display = 'none';
          document.querySelector('[data-step="2"]').style.display = 'block';
        }

        function showDocumentUpload() {
          trackEvent("Document Uploaded", {
            user_id: currentUser?.id,
            document_type: 'onboarding_documents',
            upload_method: 'web_portal'
          });

          setTimeout(() => {
            trackEvent("Document Processed", {
              user_id: currentUser?.id,
              document_type: 'onboarding_documents',
              processing_status: 'completed',
              processing_time_minutes: 2
            });

            document.querySelector('[data-step="2"]').style.display = 'none';
            document.querySelector('[data-step="3"]').style.display = 'block';
          }, 2000);
        }

        function downloadClientPacket() {
          trackEvent("Client Packet Downloaded", {
            user_id: currentUser?.id,
            packet_type: 'immigration_forms',
            download_method: 'web_portal'
          });

          setTimeout(() => {
            trackEvent("Onboarding Finished", {
              user_id: currentUser?.id,
              onboarding_duration_minutes: 15,
              completion_rate: 100
            });

            closeModal('onboardingModal');
            currentStage = 'onboarding_finished';
            
            // Show NPS after onboarding
            setTimeout(() => showNPSModal('onboarding'), 2000);
          }, 1000);
        }

        document.getElementById("signupForm").addEventListener("submit", (e) => {
          e.preventDefault()

          const formData = new FormData(e.target)
          const userData = Object.fromEntries(formData.entries())

          // Simulate account creation
          currentUser = {
            id: "user_" + Date.now(),
            email: userData.email,
            firstName: userData.firstName,
            lastName: userData.lastName,
            phone: userData.phone,
            country: userData.country,
          }

          identifyUser(currentUser.id, {
            email: userData.email,
            first_name: userData.firstName,
            last_name: userData.lastName,
            phone: userData.phone,
            country_of_origin: userData.country,
            account_type: "new_user",
            signup_method: "email",
          })

          trackEvent("Account Created", {
            user_id: currentUser.id,
            email: userData.email,
            country_of_origin: userData.country,
            signup_method: "email",
            referral_source: "direct",
          })

          closeModal("signupModal")
          
          // Show product selection
          setTimeout(() => {
            showProductSelection();
          }, 1000);
        })

        function showProductSelection() {
          const productModal = document.createElement('div');
          productModal.className = 'modal';
          productModal.id = 'productModal';
          productModal.style.display = 'block';
          productModal.innerHTML = `
            <div class="modal-content">
              <span class="close" onclick="closeModal('productModal')">&times;</span>
              <h2>Choose Your Service Package</h2>
              <div style="display: flex; gap: 20px; padding: 20px;">
                <div style="border: 1px solid #ccc; padding: 20px; border-radius: 8px; flex: 1;">
                  <h3>Standard Service</h3>
                  <p>$299</p>
                  <ul>
                    <li>Document review</li>
                    <li>Basic consultation</li>
                    <li>Form assistance</li>
                  </ul>
                  <button onclick="selectProduct('standard')" class="btn btn-primary">Select Standard</button>
                </div>
                <div style="border: 1px solid #ccc; padding: 20px; border-radius: 8px; flex: 1;">
                  <h3>Premium Service</h3>
                  <p>$599</p>
                  <ul>
                    <li>Full case management</li>
                    <li>Priority support</li>
                    <li>Court representation</li>
                  </ul>
                  <button onclick="selectProduct('premium')" class="btn btn-primary">Select Premium</button>
                </div>
              </div>
            </div>
          `;
          document.body.appendChild(productModal);
        }

        function requestSupport() {
          trackEvent("Service Support Requested", {
            user_id: currentUser?.id,
            support_type: 'general_inquiry',
            request_method: 'web_form',
            current_stage: currentStage
          });

          alert('Support request submitted. Our team will contact you within 24 hours.');
        }

        function completeClientReview() {
          trackEvent("Client Review Finished", {
            user_id: currentUser?.id,
            review_type: 'case_review',
            review_outcome: 'approved',
            reviewer_id: 'legal_team_001'
          });

          // Show NPS after review
          setTimeout(() => showNPSModal('review'), 1000);
        }

        function signClientPacket() {
          trackEvent("Client Packet Signed", {
            user_id: currentUser?.id,
            packet_type: 'legal_documents',
            signature_method: 'digital'
          });

          setTimeout(() => {
            trackEvent("Client Packet Received", {
              user_id: currentUser?.id,
              packet_type: 'legal_documents',
              received_by: 'legal_department'
            });

            setTimeout(() => {
              trackEvent("Client Packet Submitted", {
                user_id: currentUser?.id,
                submission_destination: 'uscis',
                submission_method: 'electronic'
              });

              setTimeout(() => {
                trackEvent("Post Submission Process", {
                  user_id: currentUser?.id,
                  process_type: 'uscis_review',
                  estimated_timeline: '90_days'
                });

                setTimeout(() => {
                  trackEvent("Decision", {
                    user_id: currentUser?.id,
                    decision_type: 'approved',
                    decision_date: new Date().toISOString(),
                    case_id: 'case_' + Date.now()
                  });

                  // Final NPS after decision
                  setTimeout(() => showNPSModal('decision'), 2000);
                }, 5000);
              }, 3000);
            }, 2000);
          }, 1000);
        }

        // Scroll tracking
        const scrollTracked = {
          25: false,
          50: false,
          75: false,
          100: false,
        }

        window.addEventListener("scroll", () => {
          const scrollPercent = Math.round((window.scrollY / (document.body.scrollHeight - window.innerHeight)) * 100)

          Object.keys(scrollTracked).forEach((threshold) => {
            if (scrollPercent >= threshold && !scrollTracked[threshold]) {
              scrollTracked[threshold] = true
              trackEvent("Page Scroll", {
                scroll_depth: threshold + "%",
                page: "homepage",
              })
            }
          })
        })

        // Exit intent tracking
        document.addEventListener("mouseleave", (e) => {
          if (e.clientY <= 0) {
            trackEvent("Exit Intent", {
              page: "homepage",
              time_on_page: Math.round((Date.now() - performance.timing.navigationStart) / 1000),
              user_authenticated: currentUser !== null,
            })
          }
        })

        // Form abandonment tracking
        const formStartTimes = {}

        document.addEventListener("focusin", (e) => {
          if (e.target.tagName === "INPUT" || e.target.tagName === "SELECT") {
            const form = e.target.closest("form")
            if (form && !formStartTimes[form.id]) {
              formStartTimes[form.id] = Date.now()
              trackEvent("Form Started", {
                form_type: form.id,
                field_name: e.target.name,
              })
            }
          }
        })

        // Close modals when clicking outside
        window.addEventListener("click", (e) => {
          const modals = document.querySelectorAll(".modal")
          modals.forEach((modal) => {
            if (e.target === modal) {
              const modalType = modal.id.replace("Modal", "")
              trackEvent("Modal Closed", {
                modal_type: modalType,
                action: "click_outside",
              })
              modal.style.display = "none"
            }
          })
        })

        // Drag and drop functionality for file uploads
        document.addEventListener("dragover", (e) => {
          e.preventDefault()
          if (e.target.classList.contains("upload-area")) {
            e.target.classList.add("dragover")
          }
        })

        document.addEventListener("dragleave", (e) => {
          if (e.target.classList.contains("upload-area")) {
            e.target.classList.remove("dragover")
          }
        })

        document.addEventListener("drop", (e) => {
          e.preventDefault()
          if (e.target.classList.contains("upload-area")) {
            e.target.classList.remove("dragover")
            const files = e.dataTransfer.files
            if (files.length > 0) {
              const input = e.target.querySelector('input[type="file"]')
              input.files = files
              const documentType = input.id.includes("passport") ? "passport" : "id"
              handleFileUpload(input, documentType)
            }
          }
        })

        function showResourceModal(resourceType) {
            const modal = document.getElementById('resourceModal');
            const content = document.getElementById('resourceContent');
            
            // Track resource engagement
            analytics.track('Resource Viewed', {
                resource_type: resourceType,
                resource_category: 'Immigration Information',
                engagement_type: 'modal_open',
                timestamp: new Date().toISOString(),
                page_section: 'resources'
            });

            // Track time spent reading
            const startTime = Date.now();
            
            const resourceData = {
                'visa-types': {
                    title: 'Understanding Visa Types',
                    content: `
                        <h2><i class="fas fa-passport"></i> Understanding Visa Types</h2>
                        <p>Choosing the right visa is crucial for your immigration journey. Here are the main categories:</p>
                        
                        <h3>Family-Based Visas</h3>
                        <ul>
                            <li><strong>IR-1/CR-1:</strong> Spouse of U.S. citizen</li>
                            <li><strong>IR-2/CR-2:</strong> Unmarried child under 21 of U.S. citizen</li>
                            <li><strong>F1:</strong> Unmarried adult children of U.S. citizens</li>
                            <li><strong>F2A/F2B:</strong> Spouses and children of permanent residents</li>
                        </ul>
                        
                        <h3>Employment-Based Visas</h3>
                        <ul>
                            <li><strong>EB-1:</strong> Priority workers (extraordinary ability, outstanding researchers)</li>
                            <li><strong>EB-2:</strong> Advanced degree professionals</li>
                            <li><strong>EB-3:</strong> Skilled workers and professionals</li>
                            <li><strong>EB-5:</strong> Investor visas</li>
                        </ul>
                        
                        <h3>Temporary Visas</h3>
                        <ul>
                            <li><strong>H-1B:</strong> Specialty occupation workers</li>
                            <li><strong>L-1:</strong> Intracompany transferees</li>
                            <li><strong>O-1:</strong> Individuals with extraordinary ability</li>
                            <li><strong>TN:</strong> NAFTA professionals</li>
                        </ul>
                        
                        <p><strong>Next Steps:</strong> Our experts can help determine which visa category best fits your situation and guide you through the application process.</p>
                    `
                },
                'green-card': {
                    title: 'Green Card Process',
                    content: `
                        <h2><i class="fas fa-id-card"></i> Path to Permanent Residency</h2>
                        <p>A Green Card grants you permanent resident status in the United States. Here's what you need to know:</p>
                        
                        <h3>Eligibility Categories</h3>
                        <ul>
                            <li><strong>Family Sponsorship:</strong> Through qualifying family relationships</li>
                            <li><strong>Employment:</strong> Through job offers or special skills</li>
                            <li><strong>Investment:</strong> Through significant business investment (EB-5)</li>
                            <li><strong>Diversity Lottery:</strong> Annual random selection program</li>
                            <li><strong>Asylum/Refugee:</strong> After one year of protected status</li>
                        </ul>
                        
                        <h3>Application Process</h3>
                        <ul>
                            <li><strong>Step 1:</strong> Determine eligibility and file petition</li>
                            <li><strong>Step 2:</strong> Wait for priority date to become current</li>
                            <li><strong>Step 3:</strong> File Form I-485 (if in U.S.) or consular processing</li>
                            <li><strong>Step 4:</strong> Attend biometrics appointment</li>
                            <li><strong>Step 5:</strong> Complete interview (if required)</li>
                            <li><strong>Step 6:</strong> Receive decision</li>
                        </ul>
                        
                        <h3>Processing Times</h3>
                        <p>Processing times vary significantly based on your category and country of birth. Family-based applications can take 1-20+ years, while employment-based applications typically take 1-10+ years.</p>
                        
                        <p><strong>Important:</strong> Maintaining legal status throughout the process is crucial. We can help you navigate complex timing and requirements.</p>
                    `
                },
                'citizenship': {
                    title: 'Path to U.S. Citizenship',
                    content: `
                        <h2><i class="fas fa-flag-usa"></i> Becoming a U.S. Citizen</h2>
                        <p>U.S. citizenship is the final step in your immigration journey, providing full rights and protections.</p>
                        
                        <h3>Eligibility Requirements</h3>
                        <ul>
                            <li><strong>Age:</strong> Must be 18 or older</li>
                            <li><strong>Residency:</strong> Permanent resident for at least 5 years (3 years if married to U.S. citizen)</li>
                            <li><strong>Physical Presence:</strong> At least 30 months in U.S. during 5-year period</li>
                            <li><strong>Continuous Residence:</strong> No trips outside U.S. longer than 6 months</li>
                            <li><strong>English Proficiency:</strong> Ability to read, write, and speak basic English</li>
                            <li><strong>Civics Knowledge:</strong> Knowledge of U.S. history and government</li>
                            <li><strong>Good Moral Character:</strong> No serious criminal history</li>
                        </ul>
                        
                        <h3>Application Process (Form N-400)</h3>
                        <ul>
                            <li><strong>Step 1:</strong> Complete and file Form N-400</li>
                            <li><strong>Step 2:</strong> Attend biometrics appointment</li>
                            <li><strong>Step 3:</strong> Complete naturalization interview and tests</li>
                            <li><strong>Step 4:</strong> Receive decision</li>
                            <li><strong>Step 5:</strong> Take Oath of Allegiance ceremony</li>
                        </ul>
                        
                        <h3>Benefits of Citizenship</h3>
                        <ul>
                            <li>Right to vote in federal elections</li>
                            <li>Eligibility for federal jobs</li>
                            <li>Protection from deportation</li>
                            <li>Ability to sponsor more family members</li>
                            <li>U.S. passport for international travel</li>
                        </ul>
                        
                        <p><strong>Preparation is Key:</strong> We offer comprehensive citizenship test preparation and application assistance to maximize your chances of success.</p>
                    `
                },
                'family-immigration': {
                    title: 'Family Immigration',
                    content: `
                        <h2><i class="fas fa-heart"></i> Bringing Family to the United States</h2>
                        <p>Family reunification is a cornerstone of U.S. immigration policy. Here's how to bring your loved ones to America:</p>
                        
                        <h3>Who Can Sponsor Family Members</h3>
                        <ul>
                            <li><strong>U.S. Citizens can sponsor:</strong> Spouses, children, parents, and siblings</li>
                            <li><strong>Permanent Residents can sponsor:</strong> Spouses and unmarried children only</li>
                        </ul>
                        
                        <h3>Immediate Relatives (No Wait Time)</h3>
                        <ul>
                            <li>Spouses of U.S. citizens</li>
                            <li>Unmarried children under 21 of U.S. citizens</li>
                            <li>Parents of U.S. citizens (if citizen is 21 or older)</li>
                        </ul>
                        
                        <h3>Family Preference Categories (Limited Annual Numbers)</h3>
                        <ul>
                            <li><strong>F1:</strong> Unmarried adult children of U.S. citizens</li>
                            <li><strong>F2A:</strong> Spouses and unmarried children under 21 of permanent residents</li>
                            <li><strong>F2B:</strong> Unmarried adult children of permanent residents</li>
                            <li><strong>F3:</strong> Married children of U.S. citizens</li>
                            <li><strong>F4:</strong> Siblings of U.S. citizens</li>
                        </ul>
                        
                        <h3>Required Documents</h3>
                        <ul>
                            <li>Proof of relationship (birth certificates, marriage certificates)</li>
                            <li>Proof of sponsor's status (citizenship or green card)</li>
                            <li>Financial support documentation (Form I-864)</li>
                            <li>Medical examinations</li>
                            <li>Police clearances</li>
                        </ul>
                        
                        <p><strong>Complex Process:</strong> Family immigration involves multiple forms, strict deadlines, and detailed documentation. Our experienced team guides families through every step.</p>
                    `
                },
                'work-permits': {
                    title: 'Work Authorization',
                    content: `
                        <h2><i class="fas fa-briefcase"></i> Working Legally in the United States</h2>
                        <p>There are several pathways to obtain work authorization in the United States, each with specific requirements and benefits.</p>
                        
                        <h3>Employment Authorization Document (EAD)</h3>
                        <p>Form I-765 allows certain individuals to work legally in the U.S. for a specific period.</p>
                        
                        <h3>Who Can Apply for Work Authorization</h3>
                        <ul>
                            <li><strong>Asylum seekers:</strong> 150 days after filing (with no decision)</li>
                            <li><strong>Spouses of certain visa holders:</strong> H-4, L-2, E-2 dependents</li>
                            <li><strong>Students:</strong> F-1 OPT, CPT; J-1 academic training</li>
                            <li><strong>Adjustment of status applicants:</strong> Pending green card applications</li>
                            <li><strong>TPS beneficiaries:</strong> Temporary Protected Status holders</li>
                            <li><strong>DACA recipients:</strong> Deferred Action for Childhood Arrivals</li>
                        </ul>
                        
                        <h3>Employment-Based Immigration</h3>
                        <ul>
                            <li><strong>EB-1:</strong> Priority workers (no labor certification required)</li>
                            <li><strong>EB-2:</strong> Advanced degree professionals (may need PERM)</li>
                            <li><strong>EB-3:</strong> Skilled workers (requires PERM labor certification)</li>
                            <li><strong>EB-4:</strong> Special immigrants (religious workers, etc.)</li>
                            <li><strong>EB-5:</strong> Investor program ($800K-$1.05M investment)</li>
                        </ul>
                        
                        <h3>Temporary Work Visas</h3>
                        <ul>
                            <li><strong>H-1B:</strong> Specialty occupations (bachelor's degree required)</li>
                            <li><strong>L-1:</strong> Intracompany transfers (managers, executives, specialized knowledge)</li>
                            <li><strong>O-1:</strong> Extraordinary ability in sciences, arts, business, athletics</li>
                            <li><strong>TN:</strong> NAFTA professionals (Canadian and Mexican citizens)</li>
                        </ul>
                        
                        <p><strong>Strategic Planning:</strong> Work authorization strategies often involve multiple steps and careful timing. We help you choose the best path for your career goals.</p>
                    `
                },
                'asylum-refugee': {
                    title: 'Asylum & Refugee Protection',
                    content: `
                        <h2><i class="fas fa-shield-alt"></i> Protection for Those Fleeing Persecution</h2>
                        <p>The United States provides protection for individuals who cannot return to their home countries due to persecution or well-founded fear of persecution.</p>
                        
                        <h3>Asylum vs. Refugee Status</h3>
                        <ul>
                            <li><strong>Asylum:</strong> Applied for by individuals already in the United States</li>
                            <li><strong>Refugee:</strong> Applied for by individuals outside the United States</li>
                        </ul>
                        
                        <h3>Grounds for Protection</h3>
                        <p>Persecution or well-founded fear of persecution based on:</p>
                        <ul>
                            <li><strong>Race:</strong> Ethnic or racial identity</li>
                            <li><strong>Religion:</strong> Religious beliefs or practices</li>
                            <li><strong>Nationality:</strong> Country of origin or citizenship</li>
                            <li><strong>Political Opinion:</strong> Political beliefs or activities</li>
                            <li><strong>Membership in Particular Social Group:</strong> Shared characteristics like gender, sexual orientation, family ties</li>
                        </ul>
                        
                        <h3>Asylum Application Process</h3>
                        <ul>
                            <li><strong>One-Year Deadline:</strong> Must apply within one year of arrival (with limited exceptions)</li>
                            <li><strong>Form I-589:</strong> Application for asylum and for withholding of removal</li>
                            <li><strong>Interview or Hearing:</strong> Present your case to an asylum officer or immigration judge</li>
                            <li><strong>Decision:</strong> Grant, denial, or referral to immigration court</li>
                        </ul>
                        
                        <h3>Benefits if Granted</h3>
                        <ul>
                            <li>Protection from return to country of feared persecution</li>
                            <li>Work authorization</li>
                            <li>Ability to include spouse and unmarried children under 21</li>
                            <li>Eligibility to apply for green card after one year</li>
                            <li>Potential path to U.S. citizenship</li>
                        </ul>
                        
                        <h3>Special Considerations</h3>
                        <ul>
                            <li><strong>Credibility:</strong> Consistent, detailed testimony is crucial</li>
                            <li><strong>Country Conditions:</strong> Evidence of persecution in home country</li>
                            <li><strong>Trauma-Informed Approach:</strong> Understanding impact of persecution on memory and testimony</li>
                        </ul>
                        
                        <p><strong>Sensitive Cases:</strong> Asylum cases require careful preparation and cultural sensitivity. Our experienced attorneys understand the complexities and provide compassionate representation.</p>
                    `
                }
            };

            content.innerHTML = resourceData[resourceType].content;
            modal.style.display = 'block';
            
            // Track modal close to calculate time spent
            window.resourceStartTime = startTime;
            window.currentResource = resourceType;
        }

        function closeResourceModal() {
            const modal = document.getElementById('resourceModal');
            modal.style.display = 'block';
            
            // Track time spent reading resource
            if (window.resourceStartTime && window.currentResource) {
                const timeSpent = Math.round((Date.now() - window.resourceStartTime) / 1000);
                
                analytics.track('Resource Engagement Completed', {
                    resource_type: window.currentResource,
                    time_spent_seconds: timeSpent,
                    engagement_level: timeSpent > 30 ? 'high' : timeSpent > 10 ? 'medium' : 'low',
                    completion_type: 'modal_close',
                    timestamp: new Date().toISOString()
                });
            }
            
            modal.style.display = 'none';
        }

        let resourceSectionViewed = false;
        
        function trackScrollDepth() {
            const scrollPercent = Math.round((window.scrollY / (document.body.scrollHeight - window.innerHeight)) * 100);
            
            // Track resource section view
            const resourceSection = document.querySelector('.resources-section');
            if (resourceSection && !resourceSectionViewed) {
                const rect = resourceSection.getBoundingClientRect();
                if (rect.top < window.innerHeight && rect.bottom > 0) {
                    resourceSectionViewed = true;
                    analytics.track('Resource Section Viewed', {
                        section: 'immigration_resources',
                        scroll_depth: scrollPercent,
                        timestamp: new Date().toISOString()
                    });
                }
            }
            
            // Existing scroll depth tracking
            if (scrollPercent >= 25 && !window.scroll25) {
                window.scroll25 = true;
                analytics.track('Page Scroll Depth', { depth: '25%', page: 'homepage' });
            }
            if (scrollPercent >= 50 && !window.scroll50) {
                window.scroll50 = true;
                analytics.track('Page Scroll Depth', { depth: '50%', page: 'homepage' });
            }
            if (scrollPercent >= 75 && !window.scroll75) {
                window.scroll75 = true;
                analytics.track('Page Scroll Depth', { depth: '75%', page: 'homepage' });
            }
            if (scrollPercent >= 90 && !window.scroll90) {
                window.scroll90 = true;
                analytics.track('Page Scroll Depth', { depth: '100%', page: 'homepage' });
            }
        }

        window.addEventListener('scroll', trackScrollDepth);
    </script>
</body>
</html>
